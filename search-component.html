<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Component Dependency Chaining</title>
</head>

<script src="https://unpkg.com/vue/dist/vue.js"></script>

<body>
    <div id="app"></div>
</body>

<script>
// RESULT component
Vue.component('result', {
  template: `<div>
    <h3 v-text="title"></h3>
        <a :href="url">Find out more</a>
    </div>
  `,
  props: [ 'title', 'url' ]
});

// RESULT LIST component depends on RESULT component
Vue.component('results-list', {
  template: `
    <ul>
      <li v-for="r in results">
        <result :title="r.title" :url="r.url"></result>
      </li>
    </ul>
  `,
  props: [ 'results'],
  data() {
    return {
    };
  }
});

// Search box will chain all the components together
Vue.component('search-box', {
    template: `
    <div>
        <form action="?"  @submit="onSearch">
          <input type="text" placeholder="Search" v-model="title">
          <button type="submit" :disabled="searching">Search</button>
        </form>
        <results-list :results="results"></results-list>
    </div>
    `,
    data() {
        return {
            title: '',
            searching: false,
            results: [
            ]
        }
    },
    methods: {
        onSearch() {    
            const BASE_URL = 'https://www.omdbapi.com/?r=json';
            this.searching = true;
            request_url = BASE_URL + "&s=" + this.title

            // TODO why does this get replaced right after??
            this.results = [{title: "abc", url: "http://www.google.com"}];

            fetch(request_url)
                .then((resp) => resp.json())
                .then(function(data) {
                    // todo update search results here!
                    // maybe the results need to be separate from the search-box and nested in the root app 
                    // see how to pass data back to the root app to update results list
                 })
                .catch(function() {
                    alert("here2")
                });
        }
    }
});

new Vue({
    el: '#app',
    template: `<div>
               <h1>Search</h1>
               <h2>Movies</h2>
               <search-box></search-box>
               </div>`,
});
</script>


</html>
